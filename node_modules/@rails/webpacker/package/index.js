/* eslint global-require: 0 */
/* eslint import/no-dynamic-require: 0 */

const { resolve } = require('path')
const { existsSync } = require('fs')
const Environment = require('@rails/webpacker/package/environments/base')
const loaders = require('@rails/webpacker/package/rules')
const config = require('@rails/webpacker/package/config')
const devServer = require('@rails/webpacker/package/dev_server')
const { nodeEnv } = require('@rails/webpacker/package/env')

const createEnvironment = () => {
  const path = resolve(__dirname, 'environments', `${nodeEnv}.js`)
  const constructor = existsSync(path) ? require(path) : Environment
  return new constructor()
}

module.exports = {
  config,
  devServer,
  environment: createEnvironment(),
  Environment,
  loaders
}
